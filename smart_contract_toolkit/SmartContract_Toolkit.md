# 🎯 智能合约交互工具集

一个功能强大的 EVM 智能合约交互工具集，支持 ERC20 、NFT 调用 ABI 执行和自定义 HEX 执行。

## 🌟 功能特性

### 🪙 代币/NFT 管理器 (`erc20_nft_manager.py`)
- **ERC20 代币操作**:
  - 💸 转账全部余额 - 将目标钱包中的所有代币转账到指定地址
  - 💰 批量转账 - 向多个地址批量转账代币
  - 🔐 授权代币 - 授权指定地址使用特定数量的代币
  - 📈 增加授权额度 - 在现有授权基础上增加代币使用额度
  - ❌ 撤销授权 - 撤销指定地址的代币授权

- **NFT 管理**:
  - 🎨 设置全部 NFT 授权 - 设置指定地址对所有 NFT 的授权状态
  - 🎭 转移全部 NFT - 将目标钱包中的所有 NFT 转移到指定地址
  - 🔍 智能标准检测 - 自动识别 ERC721 和 ERC1155 标准

- **智能功能**:
  - ⚡ 智能 Gas 管理 - 动态 Gas 价格和限制预估
  - 💳 余额补充 - 自动检查并补充 Gas 费用
  - 🔄 交易状态监控 - 实时跟踪交易执行状态
  - 🛡️ 合约验证 - 自动验证合约地址和标准

### 🔧 自定义 HEX 执行器 (`custom_hex_executor.py`)
- **自定义 HEX 调用**: 支持任意合约函数调用
- **HEX 数据解析**: 智能解析和验证 HEX 数据格式
- **合约验证**: 自动验证合约地址有效性和代码存在性
- **HEX 数据验证**: 格式检查、长度验证和选择器验证
- **智能 Gas 管理**: 动态 Gas 价格和限制预估
- **余额补充**: 自动检查并补充 Gas 费用
- **灵活配置**: 支持自定义合约地址和调用数据
- **交易状态监控**: 实时跟踪交易执行状态
- **错误处理**: 详细的错误分析和智能重试机制

## 🚀 快速开始

### 配置环境变量
创建 `.env` 文件并配置以下参数：

```env
# RPC 配置
RPC_URL=https://your-rpc-endpoint   # 可访问 https://chainlist.org/zh 获取
PRIVATE_RPC=https://your-private-rpc  # 可选，可在 Alchemy、Infura、Ankr、QuickNode 等提供商上免费注册

# 钱包配置
TAR_WALLET_PRIVATE_KEY=your_target_wallet_private_key
AID_WALLET_PRIVATE_KEY=your_aid_wallet_private_key
```

## 📖 使用指南

### 🪙 代币NFT管理器
#### 运行程序
- **适用 linux/wsl/macOS 系统**
```bash
# 在 smart_contract_toolkit 目录下执行以下命令
poetry run python3 erc20_nft_manager.py
```
- **适用 windows 系统**
```powershell
# 在 smart_contract_toolkit 目录下执行以下命令
python erc20_nft_manager.py
```

#### 选择操作
程序提供以下功能选项：

| 选项 | 功能 | 描述 |
|------|------|------|
| 1 | 💸 转账全部余额 | 将目标钱包中的所有代币转账到指定钱包地址 |
| 2 | 💰 批量转账 | 向多个地址批量转账代币 |
| 3 | 🔐 授权代币 | 授权指定地址使用特定数量的代币 |
| 4 | 📈 增加授权额度 | 在现有授权基础上增加代币使用额度 |
| 5 | ❌ 撤销授权 | 撤销指定地址的代币授权 |
| 6 | 🎨 设置全部 NFT 授权 | 设置指定地址对所有 NFT 的授权状态 |
| 7 | 🎭 转移全部 NFT | 将目标钱包中的所有 NFT 转移到指定地址 |


### 🔧 自定义合约执行器

#### 运行程序
- **适用 linux/wsl/macOs 系统**
```bash
# 在 smart_contract_toolkit 目录下执行以下命令
poetry run python3 execute_for_hex.py
```
- **适用 windows 系统**
```powershell
# 在 smart_contract_toolkit 目录下执行以下命令
python execute_for_hex.py
```

#### 自定义 HEX 数据
输入要执行的函数调用数据，格式为：
```
0x + 函数选择器(4字节) + 参数
```
示例
```
# ERC20 transfer 函数调用
0xa9059cbb0000000000000000000000001234567890abcdef1234567890abcdef1234567800000000000000000000000000000000000000000000000000000000000003e8

# ERC20 approve 函数调用
0x095ea7b30000000000000000000000001234567890abcdef1234567890abcdef1234567800000000000000000000000000000000000000000000000000000000000003e8
```

## 🔧 高级功能

### Gas 管理
- **动态 Gas 价格**: 自动获取当前网络 Gas 价格并提高 20%
- **智能 Gas 限制**: 自动预估 Gas 限制并增加 20% 缓冲
- **余额自动补充**: 自动检查钱包余额，不足时自动补充
- **费用预估**: 实时显示预估 Gas 费用

### 错误处理
- **网络连接**: 自动检测 RPC 连接状态
- **交易失败**: 详细的错误分析和建议
- **超时处理**: 智能等待和重试机制
- **合约验证**: 自动验证合约地址和代码存在性

### 安全特性
- **私钥保护**: 支持环境变量配置，避免硬编码
- **地址验证**: 自动验证以太坊地址格式
- **合约验证**: 验证合约地址有效性
- **权限检查**: 自动检查合约调用权限

### NFT 标准支持
- **ERC721**: 支持单个 NFT 转移和批量转移
- **ERC1155**: 支持多代币类型转移
- **智能检测**: 自动识别 NFT 标准类型
- **Token ID 扫描**: 自动获取用户拥有的 NFT Token ID


### ❓ 常见问题

#### 1. 连接失败
```
❌ 无法连接到 RPC，请检查 RPC_URL 是否正确
```
**解决方案**: 
- 检查 RPC URL 是否正确
- 验证网络连接是否正常
- 确认 RPC 服务商状态

#### 2. Gas 预估失败
```
❌ 预估 gas 失败: execution reverted
```
**解决方案**: 
- 检查合约地址是否正确
- 验证函数调用参数
- 确认合约状态和权限

#### 3. 余额不足
```
❌ 余额不足，请检查钱包余额
```
**解决方案**: 
- 确保钱包有足够的原生代币支付 Gas 费用
- 检查代币余额是否足够
- 考虑降低转账金额

#### 4. NFT 转移失败
```
❌ 无法获取 NFT Token ID
```
**解决方案**:
- 确认合约是否为标准 ERC721/ERC1155
- 检查钱包是否真的拥有这些 NFT
- 验证合约是否实现了必要的接口

#### 5. 授权失败
```
❌ 授权操作失败
```
**解决方案**:
- 检查合约是否为 ERC20 标准
- 验证被授权地址格式
- 确认授权金额是否合理

## 💬 联系与支持
- Telegram: [t.me/cryptostar210](https://t.me/cryptostar210)
- 请我喝杯☕：**0xd328426a8e0bcdbbef89e96a91911eff68734e84** ▋**5LmGJmv7Lbjh9K1gEer47xSHZ7mDcihYqVZGoPMRo89s**